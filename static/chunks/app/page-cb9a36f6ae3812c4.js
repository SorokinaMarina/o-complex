(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{581:function(e,t,n){Promise.resolve().then(n.bind(n,2036))},2036:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return k}});var a=n(7437),c=n(2265);n(8216),n(4027);var r=n(1252),s=n(7702),i=n.n(s);let o="http://o-complex.com:1337/";async function l(){return new Promise((e,t)=>{i().ajax({url:"".concat(o,"reviews"),type:"GET",success:function(n){n||(console.error("Произошла ошибка при получении данных с сервера"),t("Произошла ошибка при получении данных с сервера")),e(n)},error:function(e,n,a){console.error("Произошла ошибка при загрузке данных ".concat(a)),t("Произошла ошибка при загрузке данных ".concat(a))}})})}async function u(){return new Promise((e,t)=>{i().ajax({url:"".concat(o,"products?page=1&page_size=20"),type:"GET",success:function(n){n||(console.error("Произошла ошибка при получении данных с сервера"),t("Произошла ошибка при получении данных с сервера")),e(n)},error:function(e,n,a){console.error("Произошла ошибка при загрузке данных ".concat(a)),t("Произошла ошибка при загрузке данных ".concat(a))}})})}async function d(e){return new Promise((t,n)=>{i().ajax({url:"".concat(o,"order"),type:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(e),success:function(e){e||(console.error("Произошла ошибка при получении данных с сервера"),n("Произошла ошибка при получении данных с сервера")),t(e)},error:function(e,t,a){console.error("Произошла ошибка при загрузке данных ".concat(a)),n("Произошла ошибка при загрузке данных ".concat(a))}})})}function m(){let{data:e,error:t,isLoading:n}=(0,r.ZP)("previews",()=>l());return n?(0,a.jsx)("div",{className:"feedback__loading",children:"Загружаем..."}):t?(0,a.jsx)("div",{className:"feedback__error",children:"При загрузке данных произошла ошибка. Попробуйте перезагрузить страницу."}):(0,a.jsx)("section",{className:"feedback",children:e.map((e,t)=>(0,a.jsx)("div",{className:"feedback__container",dangerouslySetInnerHTML:{__html:e.text}},t))})}n(9469);let _=(0,c.createContext)();var p=n(370);let f=(0,c.createContext)();var x=n(5584);let h=(0,c.createContext)();function j(e){let{product:t,setOpenPopup:n}=e,r=(0,c.useContext)(_),s=(0,c.useContext)(f),i=(0,c.useContext)(h),[o,l]=(0,c.useState)(""),[u,m]=(0,c.useState)(null),[j,b]=(0,c.useState)(""),{trigger:N}=(0,x.Z)("order",()=>d(t));return(0,c.useEffect)(()=>{void 0===o?(b("Введите номер телефона чтобы оформить заказ."),m(!1)):11!==t.phone.length||void 0===o?(b("Номер телефона должен состоять из 11 цифр."),m(!1)):0===t.cart.length?(b("Корзина товаров пуста."),m(!1)):(b(""),m(!0)),null===u&&b("")},[o,t.cart]),(0,a.jsx)("section",{className:"form",children:(0,a.jsxs)("div",{className:"form__container",children:[(0,a.jsx)("h3",{className:"form__title",children:"Добавленные товары"}),(0,a.jsx)("table",{className:"form__table",children:(0,a.jsx)("tbody",{className:"form__table-body",children:r.map(e=>(0,a.jsxs)("tr",{className:"form__table-row",children:[(0,a.jsx)("td",{className:"form__table-data form__table-data_invisible-ending",children:e.title}),(0,a.jsxs)("td",{className:"form__table-data",children:["x",e.quantity]}),(0,a.jsx)("td",{className:"form__table-data",children:e.price*e.quantity})]},e.id))})}),(0,a.jsx)("span",{className:"form__error-text",children:j}),(0,a.jsxs)("form",{className:"form__template",action:"#",id:"basket-form",name:"basket-form",onSubmit:function(e){e.preventDefault();try{N(),m(null),b(""),l(""),i([]),s({phone:"",cart:[]}),n(!0)}catch(e){console.log("Ошибка: ".concat(e))}},noValidate:!0,children:[(0,a.jsx)("fieldset",{className:"form__fieldset",children:(0,a.jsx)("label",{className:"form__label ".concat(""!==j&&"form__label_error"),htmlFor:"form-input-phone",children:(0,a.jsx)(p.oc,{className:"form__input",name:"form-input",id:"form-input-phone",type:"phone",placeholder:"+7(___)___ __-__",mask:"+{7}(000)000-00-00",value:o,onAccept:function(e){l(e),s({...t,phone:e.replace(/\D/g,"")})}})})}),(0,a.jsx)("button",{className:"form__button ".concat(!u&&"form__button_error"),type:"submit",disabled:!u,children:"заказать"})]})]})})}n(9372),n(8487);var b=n(703);n(7942);let N=(0,c.createContext)();function v(e){let{id:t,title:n,price:r}=e,s=(0,c.useContext)(N),i=(0,c.useContext)(f),o=(0,c.useContext)(h);return(0,a.jsx)("button",{className:"button",type:"button",onClick:()=>{s.cart.forEach(e=>e.id===t)||(i(e=>({...e,cart:[...e.cart,{id:t,quantity:1}]})),o(e=>[...e,{title:n,id:t,price:r,quantity:1,countActive:!0}]))},children:"купить"})}function y(e){let{id:t}=e,n=(0,c.useContext)(N),r=(0,c.useContext)(f),s=(0,c.useContext)(h),i=(0,c.useContext)(_),o=0!==n.cart.length&&n.cart.find(e=>e.id===t);function l(e){let a=n.cart.map(n=>{if(n.id===+t){if("subtraction"===e)return{...n,quantity:+n.quantity-1};if("addition"===e)return{...n,quantity:+n.quantity+1}}return n}),c=i.map(n=>{if(n.id===+t){if("subtraction"===e)return{...n,quantity:+n.quantity-1};if("addition"===e)return{...n,quantity:+n.quantity+1}}return n}),o=a.filter(e=>e.quantity>0),l=c.filter(e=>e.quantity>0);r(e=>({...e,cart:o})),s(l)}return(0,a.jsxs)("div",{className:"input-count",children:[(0,a.jsx)("button",{className:"input-count__button",type:"button",onClick:function(){l("subtraction")},children:"-"}),(0,a.jsx)("label",{className:"input-count__label",htmlFor:t,children:(0,a.jsx)("input",{className:"input-count__field",id:t,type:"number",placeholder:o.quantity,value:o.quantity,onChange:function(e){let{id:t,value:a}=e.target,c=n.cart.map(e=>e.id===+t?{...e,quantity:parseInt(a,10)||0}:e),o=i.map(e=>e.id===+t?{...e,quantity:parseInt(a,10)||0}:e);r(e=>({...e,cart:c})),s(o)},onBlur:function(){let e=n.cart.filter(e=>e.quantity>0),t=i.filter(e=>e.quantity>0);r(t=>({...t,cart:e})),s(t)},name:"input"})}),(0,a.jsx)("button",{className:"input-count__button",type:"button",onClick:function(){l("addition")},children:"+"})]})}function g(e){let{image_url:t,title:n,description:r,price:s,id:i}=e,o=(0,c.useContext)(_).find(e=>e.id===i),l=!!o&&o.countActive;return(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("div",{className:"card__flex-container",children:[(0,a.jsxs)("div",{className:"card__container",children:[(0,a.jsx)(b.default,{className:"card__img",src:t,alt:n,width:281,height:366}),(0,a.jsx)("h3",{className:"card__title",children:n}),(0,a.jsx)("p",{className:"card__description",children:r})]}),(0,a.jsxs)("div",{className:"card__container-buy",children:[(0,a.jsxs)("p",{className:"card__price",children:[" Цена: ",s,"₽"]}),l?(0,a.jsx)(y,{id:i}):(0,a.jsx)(v,{title:n,price:s,id:i})]})]})})}function C(){let{data:e,isLoading:t,error:n}=(0,r.ZP)("products",()=>u());return t?(0,a.jsx)("div",{className:"cards-list__loading",children:"Загружаем..."}):n?(0,a.jsx)("div",{className:"cards-list__error",children:"При загрузке данных произошла ошибка. Попробуйте перезагрузить страницу."}):(0,a.jsx)("section",{className:"cards-list",children:e.products.map(e=>(0,a.jsx)(g,{...e},e.id))})}n(5811),n(2192);var w={src:"/_next/static/media/close-icon.ebec7433.svg",height:28,width:28,blurWidth:0,blurHeight:0},q=function(e){let{openPopup:t,onClose:n,popupName:r,setOpenPopup:s}=e;return(0,c.useEffect)(()=>{let e=e=>{("Escape"===e.key||"Esc"===e.key)&&n()},t=e=>{e.target.classList.contains("popup_opened")&&n()};return window.addEventListener("keydown",e),window.addEventListener("mousedown",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("mousedown",t)}},[n]),(0,a.jsx)("div",{className:"popup ".concat(r," ").concat(t?"popup_opened":""),children:(0,a.jsxs)("div",{className:"popup__container",children:[(0,a.jsx)("button",{className:"popup__button",type:"button",onClick:()=>{s(!1)},children:(0,a.jsx)(b.default,{className:"popup__image",src:w,alt:"exit"})}),(0,a.jsx)("p",{className:"popup__text",children:"Данные успешно отправлены."})]})})};function k(){let[e,t]=(0,c.useState)({phone:"",cart:[]}),[n,r]=(0,c.useState)([]),[s,i]=(0,c.useState)(!1);return(0,c.useEffect)(()=>{localStorage.setItem("product",JSON.stringify(e))},[e]),(0,a.jsx)("main",{className:"main",children:(0,a.jsx)(N.Provider,{value:e,children:(0,a.jsx)(f.Provider,{value:t,children:(0,a.jsx)(_.Provider,{value:n,children:(0,a.jsxs)(h.Provider,{value:r,children:[(0,a.jsx)("h1",{className:"main__title",children:"тестовое задание"}),(0,a.jsx)(m,{}),(0,a.jsx)(j,{product:e,setOpenPopup:i}),(0,a.jsx)(C,{}),(0,a.jsx)(q,{openPopup:s,setOpenPopup:i})]})})})})})}},7942:function(){},8487:function(){},9372:function(){},4027:function(){},9469:function(){},5811:function(){},8216:function(){},2192:function(){}},function(e){e.O(0,[38,108,971,69,744],function(){return e(e.s=581)}),_N_E=e.O()}]);